## 📆 2024-06-21

### 🔔 스크럼

- 학습 목표 1 : JPA 1차 캐시와 2차 캐시

<br/>

### 🚀 Today I Learned

#### | 캐시
데이터베이스나 외부 시스템에 자주 접근해야 하는 데이터를 임시로 저장하는 메모리 공간
**효과**
- 데이터 접근 시간 감소 → 시스템 성능 향상
**종류**
- 1차 캐시
- 2차 캐시
- 메인 메모리 캐시
- 디스크 캐시

#### | 1차 캐시
`1차 캐시`란, 영속성 컨텍스트 내부에 존재하는 엔티티 보관 저장소
엔티티 매니저로 조회하거나 변경하는 모든 엔티티는 1차 캐시에 저장
- 트랜잭션을 커밋 or 플러시 호출 시 1차 캐시에 있는 엔티티의 변경 내역을 데이터베이스에 동기화
- 트랜잭션을 시작하고 종료할 때까지만 1차 캐시 유효

#### 1차 캐시의 동작 방식

1. **쿼리 실행 전 캐시 확인**:

    클라이언트가 쿼리를 실행할 때, 데이터베이스는 먼저 JPQ 1차 캐시에서 해당 쿼리 결과가 이미 저장되어 있는지 확인
    
2. **캐시 적중 시 응답 반환**:

    쿼리 결과가 캐시에 저장되어 있는 경우, 데이터베이스는 즉시 캐시된 결과를 클라이언트에게 반환
    
3. **캐시 미스 시 데이터베이스 쿼리 실행**:

    쿼리 결과가 캐시에 없는 경우, 데이터베이스는 실제로 쿼리를 실행
    
4. **캐시 업데이트**:

    쿼리 결과를 얻은 후, 데이터베이스는 해당 결과를 JPQ 1차 캐시에 저장


#### | 2차 캐시
`2차 캐시` 는, 애플리케이션이 공유하는 캐시 → 애플리케이션 범위의 캐시
2차 캐시는 애플리케이션을 종료할 때까지 캐시가 유지

#### 2차 캐시의 동작 방식

1. **1차 캐시 확인**: 
    
    클라이언트가 쿼리를 요청하면, 데이터베이스 시스템은 먼저 1차 캐시를 확인
    1차 캐시에 쿼리 결과가 있으면, 즉시 반환
    
2. **2차 캐시 확인**: 
    
    1차 캐시에 결과가 없으면, 데이터베이스 시스템은 2차 캐시를 확인
    2차 캐시에 쿼리 결과가 있으면, 결과 반환 (객체가 아닌 복사본 반환)
    해당 결과를 1차 캐시에 저장
    
3. **캐시 미스 시 데이터베이스 쿼리 실행**: 
    
    1차 캐시, 2차 캐시 모두 데이터가 없을 경우,  쿼리를 실행하여 결과 얻기
    
4. **2차 캐시 및 1차 캐시 업데이트**: 
    
    쿼리 결과를 얻은 후, 결과를 1차, 2차 캐시에 모두 저장


<br/>

### 🔥 오늘의 도전 과제와 해결 방법

- 어떻게 구현하는지 확인해보고 실습한 후 정리

<br/>

### 🗨️ 오늘의 회고

<!--
- 오늘의 학습 경험에 대한 자유로운 생각이나 느낀 점을 기록합니다.
- 성공적인 점, 개선해야 할 점, 새롭게 시도하고 싶은 방법 등을 포함할 수 있습니다.-->

- 1차 캐시,,, 2차 캐시,, 어렵다 어려워....
- entity manager을 직접 써보면서 효율적으로 쿼리 관리를 해보고 싶은 생각이 들었다..
